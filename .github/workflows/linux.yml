name: Linux Ninja Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    strategy:
      matrix:
        configuration: [Debug, Release]

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: build project
      run: ./build_linux.sh
    - name: Setup Python
      uses: actions/setup-python@v5.1.0
    - name: Setup APT
      run: /usr/bin/sudo apt-get update --fix-missing
    - name: install gperf flex bison make
      run: /usr/bin/sudo apt-get install gperf flex bison ninja-build libgtk2.0-dev libgles2-mesa-dev libegl1-mesa-dev
    - name: generate javascript binding
      run: python ./tools/generated_javascriptcore_files.py ./source/webkit-2.2.8/Source/JavaScriptCore ./source/webkit-2.2.8/Source/JavaScriptCore/Generated
    - name: generate webcore binding
      run: python ./tools/generated_webcore_files.py ./source/webkit-2.2.8/Source/WebCore Generated
    - name: build Solution
      run: ninja -C ./proj/out/${{ matrix.configuration }} -j16
